<%# Shared DNS Leak Test section %>
<% intro = local_assigns.fetch(:intro_text, "Find out if your VPN is actually protecting your DNS queries from being exposed to your ISP.") %>

<!-- DNS Leak Test Section -->
<section class="bg-gray-50 py-24 sm:py-32" aria-label="DNS Leak Test">
  <div class="mx-auto max-w-7xl px-6 lg:px-8">
    <div class="mx-auto max-w-2xl text-center">
      <h2 class="text-base font-semibold leading-7 text-indigo-600">Check Your Privacy</h2>
      <p class="mt-2 text-3xl font-bold tracking-tight text-gray-900 sm:text-4xl">
        DNS Leak Test
      </p>
      <p class="mt-6 text-lg leading-8 text-gray-600">
        <%= intro %>
      </p>
    </div>
    
    <div class="mx-auto mt-16 max-w-2xl">
      <div class="rounded-lg bg-white p-8 shadow-sm ring-1 ring-gray-200">
        <div id="dns-test-container">
          <!-- Initial State -->
          <div id="dns-test-initial" class="text-center">
            <div class="mb-6 flex h-16 w-16 items-center justify-center rounded-lg bg-indigo-600 mx-auto">
              <svg class="h-8 w-8 text-white" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="M9.75 9.75l4.5 4.5m0-4.5l-4.5 4.5M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
            </div>
            <h3 class="text-xl font-semibold text-gray-900 mb-4">Test Your DNS Security</h3>
            <p class="text-gray-600 mb-6">
              Click below to check if your DNS queries are leaking to your ISP. This test works whether you're using a VPN or not.
            </p>
            <button id="start-dns-test" class="rounded-md bg-indigo-600 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600">
              Start DNS Leak Test
            </button>
          </div>
          
          <!-- Testing State -->
          <div id="dns-test-running" class="text-center hidden">
            <div class="mb-6 flex h-16 w-16 items-center justify-center rounded-lg bg-yellow-500 mx-auto">
              <svg class="h-8 w-8 text-white animate-spin" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
              </svg>
            </div>
            <h3 class="text-xl font-semibold text-gray-900 mb-4">Testing DNS Configuration...</h3>
            <p class="text-gray-600 mb-4">
              Please wait while we analyze your DNS queries...
            </p>
            <div class="w-full bg-gray-200 rounded-full h-2">
              <div id="progress-bar" class="bg-indigo-600 h-2 rounded-full transition-all duration-500 ease-out" style="width: 0%"></div>
            </div>
          </div>
          
          <!-- Results State -->
          <div id="dns-test-results" class="hidden">
            <div id="dns-results-content">
              <!-- Results will be inserted here -->
            </div>
            <div class="mt-6 text-center">
              <button id="restart-dns-test" class="rounded-md bg-gray-600 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-gray-500">
                Run Test Again
              </button>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Information about DNS leaks -->
      <div class="mt-8 rounded-lg bg-blue-50 p-6">
        <h4 class="text-lg font-semibold text-blue-900 mb-3">What is a DNS leak?</h4>
        <p class="text-blue-800 text-sm leading-6">
          A DNS leak occurs when your device sends DNS queries to your ISP's DNS servers instead of your VPN's secure DNS servers. 
          This can reveal which websites you visit, even when your traffic is encrypted through a VPN tunnel. 
          A proper VPN should route all DNS queries through its own secure servers to maintain your privacy.
        </p>
      </div>
    </div>
  </div>
</section>

