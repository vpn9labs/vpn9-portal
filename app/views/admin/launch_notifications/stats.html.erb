<div class="px-4 sm:px-6 lg:px-8">
  <div class="sm:flex sm:items-center">
    <div class="sm:flex-auto">
      <h1 class="text-2xl font-semibold text-gray-900">Launch Notification Statistics</h1>
      <p class="mt-2 text-sm text-gray-700">
        Overview of launch notification signups and trends.
      </p>
    </div>
    <div class="mt-4 sm:mt-0 sm:ml-16 sm:flex-none">
      <%= link_to "Back to List", admin_launch_notifications_path, class: "inline-flex items-center justify-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 sm:w-auto" %>
    </div>
  </div>

  <!-- Stats Grid -->
  <div class="mt-8">
    <dl class="grid grid-cols-1 gap-5 sm:grid-cols-2 lg:grid-cols-4">
      <div class="overflow-hidden rounded-lg bg-white px-4 py-5 shadow sm:p-6">
        <dt class="truncate text-sm font-medium text-gray-500">Total Signups</dt>
        <dd class="mt-1 text-3xl font-semibold tracking-tight text-gray-900">
          <%= number_with_delimiter(@total_signups) %>
        </dd>
      </div>

      <div class="overflow-hidden rounded-lg bg-white px-4 py-5 shadow sm:p-6">
        <dt class="truncate text-sm font-medium text-gray-500">Signups Today</dt>
        <dd class="mt-1 text-3xl font-semibold tracking-tight text-gray-900">
          <%= number_with_delimiter(@signups_today) %>
        </dd>
      </div>

      <div class="overflow-hidden rounded-lg bg-white px-4 py-5 shadow sm:p-6">
        <dt class="truncate text-sm font-medium text-gray-500">This Week</dt>
        <dd class="mt-1 text-3xl font-semibold tracking-tight text-gray-900">
          <%= number_with_delimiter(@signups_this_week) %>
        </dd>
      </div>

      <div class="overflow-hidden rounded-lg bg-white px-4 py-5 shadow sm:p-6">
        <dt class="truncate text-sm font-medium text-gray-500">This Month</dt>
        <dd class="mt-1 text-3xl font-semibold tracking-tight text-gray-900">
          <%= number_with_delimiter(@signups_this_month) %>
        </dd>
      </div>
    </dl>
  </div>

  <!-- Daily Signups Chart -->
  <div class="mt-8 bg-white shadow overflow-hidden sm:rounded-lg">
    <div class="px-4 py-5 sm:px-6">
      <h3 class="text-lg leading-6 font-medium text-gray-900">
        Daily Signups (Last 30 Days)
      </h3>
    </div>
    <div class="border-t border-gray-200 px-4 py-5 sm:px-6">
      <% if @daily_signups.any? %>
        <div class="h-64" id="daily-signups-chart">
          <!-- Simple text-based chart for now -->
          <div class="flex items-end justify-between h-full">
            <% max_value = @daily_signups.values.max.to_f %>
            <% @daily_signups.each do |date, count| %>
              <div class="flex flex-col items-center flex-1 mx-0.5">
                <div class="w-full bg-indigo-600 rounded-t" 
                     style="height: <%= max_value > 0 ? (count / max_value * 100) : 0 %>%"
                     title="<%= date.strftime('%b %d') %>: <%= count %> signups">
                </div>
                <div class="text-xs text-gray-500 mt-1 rotate-45 origin-left">
                  <%= date.strftime('%d') %>
                </div>
              </div>
            <% end %>
          </div>
        </div>
        
        <div class="mt-4 text-sm text-gray-500">
          <p>Daily average: <%= (@daily_signups.values.sum.to_f / @daily_signups.size).round(1) %> signups</p>
          <p>Peak day: <%= @daily_signups.max_by { |k, v| v }[0].strftime('%B %d') %> with <%= @daily_signups.values.max %> signups</p>
        </div>
      <% else %>
        <p class="text-gray-500">No signup data available for the last 30 days.</p>
      <% end %>
    </div>
  </div>

  <!-- Top Sources -->
  <div class="mt-8 bg-white shadow overflow-hidden sm:rounded-lg">
    <div class="px-4 py-5 sm:px-6">
      <h3 class="text-lg leading-6 font-medium text-gray-900">
        Top Traffic Sources
      </h3>
    </div>
    <div class="border-t border-gray-200">
      <% 
        sources = LaunchNotification.all.map { |n| n.metadata&.dig('utm_source') || 'Direct' }
        source_counts = sources.group_by(&:itself).transform_values(&:count).sort_by { |_, v| -v }.first(10)
      %>
      <% if source_counts.any? %>
        <table class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-50">
            <tr>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                Source
              </th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                Signups
              </th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                Percentage
              </th>
            </tr>
          </thead>
          <tbody class="bg-white divide-y divide-gray-200">
            <% source_counts.each do |source, count| %>
              <tr>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                  <%= source %>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                  <%= count %>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                  <%= number_to_percentage((count.to_f / @total_signups * 100), precision: 1) %>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      <% else %>
        <div class="px-6 py-4">
          <p class="text-gray-500">No source data available.</p>
        </div>
      <% end %>
    </div>
  </div>
</div>